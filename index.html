
<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Radar Navigator Egypt</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css"/>

<style>
body{margin:0;background:#111;color:#fff;font-family:Arial}
#map{height:60vh}
.info{padding:10px;text-align:center}
.alert{color:red;font-size:20px;font-weight:bold}
</style>
</head>

<body>

<div id="map"></div>

<div class="info">
  <div id="speed">ğŸš— Ø§Ù„Ø³Ø±Ø¹Ø©: -- ÙƒÙ…/Ø³</div>
  <div id="direction">ğŸ§­ Ø§Ù„Ø§ØªØ¬Ø§Ù‡: --</div>
  <div id="radar">ğŸ“¡ Ø£Ù‚Ø±Ø¨ Ø±Ø§Ø¯Ø§Ø±: --</div>
  <div class="alert" id="alert"></div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>

<script>
/* ================== Ø±Ø§Ø¯Ø§Ø±Ø§Øª Ù…ØµØ± (Ø¹ÙŠÙ†Ø© ÙƒØ¨ÙŠØ±Ø©) ================== */
const radars = [
 {lat:30.0720,lng:31.3280,speed:80,road:"Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠ"},
 {lat:30.0500,lng:31.2100,speed:60,road:"Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠ"},
 {lat:29.9765,lng:30.9494,speed:80,road:"6 Ø£ÙƒØªÙˆØ¨Ø±"},
 {lat:29.9900,lng:30.9300,speed:100,road:"6 Ø£ÙƒØªÙˆØ¨Ø±"},
 {lat:30.8266,lng:30.8197,speed:100,road:"Ù‚Ø§Ù‡Ø±Ø© Ø§Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©"},
 {lat:30.7001,lng:30.6002,speed:120,road:"Ù‚Ø§Ù‡Ø±Ø© Ø§Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©"},
 {lat:31.2057,lng:29.9245,speed:80,road:"Ø§Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©"},
 {lat:26.8206,lng:30.8025,speed:90,road:"Ø§Ù„ØµØ¹ÙŠØ¯"}
];

/* ================== Ø§Ù„Ø®Ø±ÙŠØ·Ø© ================== */
let map = L.map('map').setView([30.0444,31.2357], 13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

radars.forEach(r=>{
 L.marker([r.lat,r.lng]).addTo(map)
 .bindPopup(`ğŸ“¡ Ø±Ø§Ø¯Ø§Ø± ${r.road}<br>ğŸš— ${r.speed} ÙƒÙ…/Ø³`);
});

/* ================== Ø§Ù„ØµÙˆØª ================== */
function speak(txt,rate=1){
 let u=new SpeechSynthesisUtterance(txt);
 u.lang="ar-EG";u.rate=rate;
 speechSynthesis.speak(u);
}

/* ================== Ø£Ø¯ÙˆØ§Øª ================== */
function dist(a,b,c,d){
 const R=6371;
 const dLat=(c-a)*Math.PI/180;
 const dLon=(d-b)*Math.PI/180;
 const x=Math.sin(dLat/2)**2+
 Math.cos(a*Math.PI/180)*Math.cos(c*Math.PI/180)*Math.sin(dLon/2)**2;
 return R*2*Math.atan2(Math.sqrt(x),Math.sqrt(1-x));
}
function dir(h){
 if(h==null)return "--";
 if(h<45)return "Ø´Ù…Ø§Ù„";
 if(h<135)return "Ø´Ø±Ù‚";
 if(h<225)return "Ø¬Ù†ÙˆØ¨";
 return "ØºØ±Ø¨";
}

/* ================== ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ø± ================== */
let track=[];
let line=L.polyline([], {color:"red"}).addTo(map);

/* ================== Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ ================== */
let routing=null;
function startNav(a,b,c,d){
 if(routing)map.removeControl(routing);
 routing=L.Routing.control({
  waypoints:[L.latLng(a,b),L.latLng(c,d)],
  addWaypoints:false,
  show:false,
  router:L.Routing.osrmv1({
   serviceUrl:"https://router.project-osrm.org/route/v1"
  })
 }).addTo(map);

 routing.on("routesfound",e=>{
  e.routes[0].instructions.forEach(i=>{
   speak(i.text,1);
  });
 });
}

/* ================== GPS ================== */
let warned=false;

navigator.geolocation.watchPosition(p=>{
 let lat=p.coords.latitude;
 let lng=p.coords.longitude;
 let speed=p.coords.speed?p.coords.speed*3.6:0;
 let head=p.coords.heading;

 map.setView([lat,lng],16);

 document.getElementById("speed").innerText=`ğŸš— Ø§Ù„Ø³Ø±Ø¹Ø©: ${speed.toFixed(0)} ÙƒÙ…/Ø³`;
 document.getElementById("direction").innerText=`ğŸ§­ Ø§Ù„Ø§ØªØ¬Ø§Ù‡: ${dir(head)}`;

 track.push([lat,lng]);
 line.setLatLngs(track);

 let near=null,min=999;
 radars.forEach(r=>{
  let d=dist(lat,lng,r.lat,r.lng);
  if(d<min){min=d;near=r;}
 });

 document.getElementById("radar").innerText=
 `ğŸ“¡ Ø£Ù‚Ø±Ø¨ Ø±Ø§Ø¯Ø§Ø±: ${(min*1000).toFixed(0)} Ù…ØªØ±`;

 if(min<=1 && speed>near.speed && !warned){
  warned=true;
  document.getElementById("alert").innerText="âš ï¸ Ø±Ø§Ø¯Ø§Ø± ÙˆØ³Ø±Ø¹Ø© Ø²ÙŠØ§Ø¯Ø©";
  speak("Ø®Ø¯ Ø¨Ø§Ù„Ùƒ Ø±Ø§Ø¯Ø§Ø± Ù‚Ø¯Ø§Ù…Ùƒ");
  speak("Ø§Ù„Ø³Ø±Ø¹Ø© Ø£Ø¹Ù„Ù‰ Ù…Ù† Ø§Ù„Ù…Ø³Ù…ÙˆØ­");
  speak("Ø§Ù‡Ø¯Ù Ø§Ù„Ø³Ø±Ø¹Ø© ÙÙˆØ±Ø§Ù‹");
  speak("Ø§Ø­ØªÙ…Ø§Ù„ Ù…Ø®Ø§Ù„ÙØ©");

  startNav(lat,lng,near.lat,near.lng);
 }

 if(min>1){warned=false;document.getElementById("alert").innerText="";}

},()=>alert("ÙØ¹Ù‘Ù„ GPS"),{enableHighAccuracy:true});
</script>

</body>
</html>
